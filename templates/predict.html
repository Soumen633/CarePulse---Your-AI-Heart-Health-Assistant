{% extends "base.html" %} {% block title %}Heart Disease Prediction -
CarePulse{% endblock %} {% block content %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-lg">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">
            <i class="fas fa-heartbeat me-2"></i>Heart Disease Risk Assessment
          </h3>
        </div>
        <div class="card-body p-4">
          <p class="text-muted mb-4">
            <i class="fas fa-info-circle me-2"></i>
            Fill in your key health metrics below. Optional fields are
            pre-filled with typical values.
          </p>

          <form
            method="POST"
            action="{{ url_for('predict') }}"
            id="predictionForm"
          >
            <!-- PRIMARY FEATURES (Required) - Based on CatBoost Feature Importance -->
            <!-- PRIMARY FEATURES (Required) - Based on CatBoost Feature Importance -->
            <div class="alert alert-info">
              <i class="fas fa-chart-bar me-2"></i>
              <strong>Essential Health Metrics</strong> - These have the highest
              impact on prediction
            </div>

            <div class="row g-3 mb-4">
              <!-- Blood Pressure (Systolic) - MOST IMPORTANT -->
              <div class="col-md-6">
                <label for="ap_hi" class="form-label">
                  <i class="fas fa-heartbeat me-1 text-danger"></i>
                  Systolic Blood Pressure (mmHg)
                  <span class="text-danger">*</span>
                </label>
                <input
                  type="number"
                  class="form-control"
                  id="ap_hi"
                  name="ap_hi"
                  min="70"
                  max="250"
                  step="1"
                  required
                />
                <small class="text-muted">Top reading - Normal: 90-120</small>
              </div>

              <!-- Age - 2nd MOST IMPORTANT -->
              <div class="col-md-6">
                <label for="age" class="form-label">
                  <i class="fas fa-calendar-alt me-1 text-primary"></i>
                  Age (years) <span class="text-danger">*</span>
                </label>
                <input
                  type="number"
                  class="form-control"
                  id="age"
                  name="age"
                  min="1"
                  max="120"
                  step="1"
                  required
                />
              </div>

              <!-- Weight - 3rd MOST IMPORTANT -->
              <div class="col-md-6">
                <label for="weight" class="form-label">
                  <i class="fas fa-weight me-1 text-success"></i>
                  Weight (kg) <span class="text-danger">*</span>
                </label>
                <input
                  type="number"
                  class="form-control"
                  id="weight"
                  name="weight"
                  min="20"
                  max="300"
                  step="0.1"
                  required
                />
              </div>

              <!-- Height - 4th MOST IMPORTANT -->
              <div class="col-md-6">
                <label for="height" class="form-label">
                  <i class="fas fa-ruler-vertical me-1 text-info"></i>
                  Height (cm) <span class="text-danger">*</span>
                </label>
                <input
                  type="number"
                  class="form-control"
                  id="height"
                  name="height"
                  min="100"
                  max="250"
                  step="1"
                  required
                />
              </div>

              <!-- Cholesterol - 5th MOST IMPORTANT -->
              <div class="col-md-6">
                <label for="cholesterol" class="form-label">
                  <i class="fas fa-vial me-1 text-warning"></i>
                  Cholesterol Level <span class="text-danger">*</span>
                </label>
                <select
                  class="form-select"
                  id="cholesterol"
                  name="cholesterol"
                  required
                >
                  <option value="">Select Level</option>
                  <option value="1">Normal</option>
                  <option value="2">Above Normal</option>
                  <option value="3">Well Above Normal</option>
                </select>
              </div>

              <!-- Blood Pressure (Diastolic) - 6th MOST IMPORTANT -->
              <div class="col-md-6">
                <label for="ap_lo" class="form-label">
                  <i class="fas fa-heartbeat me-1 text-secondary"></i>
                  Diastolic Blood Pressure (mmHg)
                  <span class="text-danger">*</span>
                </label>
                <input
                  type="number"
                  class="form-control"
                  id="ap_lo"
                  name="ap_lo"
                  min="40"
                  max="150"
                  step="1"
                  required
                />
                <small class="text-muted">Bottom reading - Normal: 60-80</small>
              </div>
            </div>

            <!-- BMI Calculator Helper -->
            <div class="alert alert-light border">
              <div class="row align-items-center">
                <div class="col-auto">
                  <i class="fas fa-calculator fa-2x text-primary"></i>
                </div>
                <div class="col">
                  <strong>BMI will be automatically calculated</strong> from
                  your height and weight
                  <div class="mt-2" id="bmiDisplay"></div>
                </div>
              </div>
            </div>

            <!-- OPTIONAL FEATURES (Collapsible) -->
            <div class="mb-4">
              <button
                class="btn btn-outline-secondary w-100"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#additionalOptions"
                aria-expanded="false"
                aria-controls="additionalOptions"
              >
                <i class="fas fa-sliders-h me-2"></i>Additional Health Factors
                (Optional)
                <i class="fas fa-chevron-down float-end mt-1"></i>
              </button>
            </div>

            <div class="collapse" id="additionalOptions">
              <div class="alert alert-secondary">
                <i class="fas fa-lightbulb me-2"></i>
                These fields have lower impact on prediction and are pre-filled
                with typical values.
              </div>

              <div class="row g-3 mb-4">
                <!-- Glucose -->
                <div class="col-md-6">
                  <label for="gluc" class="form-label">
                    <i class="fas fa-tint me-1"></i>Glucose Level
                  </label>
                  <select class="form-select" id="gluc" name="gluc">
                    <option value="1" selected>Normal</option>
                    <option value="2">Above Normal</option>
                    <option value="3">Well Above Normal</option>
                  </select>
                </div>

                <!-- Active Lifestyle -->
                <div class="col-md-6">
                  <label for="active" class="form-label">
                    <i class="fas fa-running me-1"></i>Physically Active
                  </label>
                  <select class="form-select" id="active" name="active">
                    <option value="0">No</option>
                    <option value="1" selected>Yes</option>
                  </select>
                </div>

                <!-- Alcohol -->
                <div class="col-md-6">
                  <label for="alco" class="form-label">
                    <i class="fas fa-wine-glass me-1"></i>Alcohol Consumption
                  </label>
                  <select class="form-select" id="alco" name="alco">
                    <option value="0" selected>No</option>
                    <option value="1">Yes</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="gender" class="form-label">
                    <i class="fas fa-venus-mars me-1 text-primary"></i>
                    Gender <span class="text-danger">*</span>
                  </label>
                  <select
                    class="form-select"
                    id="gender"
                    name="gender"
                    required
                  >
                    <option value="">Select Gender</option>
                    <option value="2" selected>Male</option>
                    <option value="1">Female</option>
                  </select>
                </div>

                <!-- Smoking -->
                <div class="col-md-6">
                  <label for="smoke" class="form-label">
                    <i class="fas fa-smoking me-1"></i>Smoking
                  </label>
                  <select class="form-select" id="smoke" name="smoke">
                    <option value="0" selected>No</option>
                    <option value="1">Yes</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="d-grid gap-2 mt-4">
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-chart-line me-2"></i>Analyze My Risk
              </button>
              <a
                href="{{ url_for('index') }}"
                class="btn btn-outline-secondary"
              >
                <i class="fas fa-arrow-left me-2"></i>Back to Home
              </a>
            </div>
          </form>
        </div>
      </div>

      <!-- Feature Importance Info Card -->
      <div class="card mt-4 bg-light border-0">
        <div class="card-body">
          <h6 class="text-muted mb-3">
            <i class="fas fa-info-circle me-2"></i>Why these metrics matter
          </h6>
          <div class="row g-2 small">
            <div class="col-md-6">
              <span class="badge bg-danger me-2">1</span>
              <strong>Blood Pressure:</strong> Primary heart health indicator
            </div>
            <div class="col-md-6">
              <span class="badge bg-primary me-2">2</span>
              <strong>Age:</strong> Risk increases with age
            </div>
            <div class="col-md-6">
              <span class="badge bg-success me-2">3</span>
              <strong>Weight:</strong> Affects cardiovascular strain
            </div>
            <div class="col-md-6">
              <span class="badge bg-info me-2">4</span>
              <strong>Height:</strong> Used with weight for BMI
            </div>
            <div class="col-md-6">
              <span class="badge bg-warning me-2">5</span>
              <strong>Cholesterol:</strong> Arterial health indicator
            </div>
            <div class="col-md-6">
              <span class="badge bg-secondary me-2">6</span>
              <strong>Diastolic BP:</strong> Heart relaxation pressure
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  // Real-time BMI Calculator
  function calculateBMI() {
    const weight = parseFloat(document.getElementById("weight").value);
    const height = parseFloat(document.getElementById("height").value);

    if (weight && height && height > 0) {
      const heightInMeters = height / 100;
      const bmi = (weight / (heightInMeters * heightInMeters)).toFixed(1);

      let category = "";
      let colorClass = "";

      if (bmi < 18.5) {
        category = "Underweight";
        colorClass = "text-info";
      } else if (bmi < 25) {
        category = "Normal";
        colorClass = "text-success";
      } else if (bmi < 30) {
        category = "Overweight";
        colorClass = "text-warning";
      } else {
        category = "Obese";
        colorClass = "text-danger";
      }

      document.getElementById(
        "bmiDisplay"
      ).innerHTML = `<strong class="${colorClass}">BMI: ${bmi}</strong> (${category})`;
    }
  }

  // Add event listeners for BMI calculation
  document.getElementById("weight").addEventListener("input", calculateBMI);
  document.getElementById("height").addEventListener("input", calculateBMI);

  // Form validation
  document
    .getElementById("predictionForm")
    .addEventListener("submit", function (e) {
      const ap_hi = parseFloat(document.getElementById("ap_hi").value);
      const ap_lo = parseFloat(document.getElementById("ap_lo").value);

      if (ap_hi <= ap_lo) {
        e.preventDefault();
        alert(
          "Systolic blood pressure must be higher than diastolic blood pressure."
        );
        return false;
      }
    });
</script>
{% endblock %} {% block extra_css %}
<style>
  .form-label {
    font-weight: 600;
    color: #495057;
    margin-bottom: 0.5rem;
  }

  .form-control,
  .form-select {
    border-radius: 0.5rem;
    border: 2px solid #e9ecef;
    transition: border-color 0.3s;
  }

  .form-control:focus,
  .form-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
  }

  .card {
    border: none;
    border-radius: 1rem;
  }

  .card-header {
    border-radius: 1rem 1rem 0 0 !important;
    padding: 1.5rem;
  }

  .collapse {
    transition: all 0.3s ease;
  }

  small.text-muted {
    font-size: 0.85rem;
    display: block;
    margin-top: 0.25rem;
  }

  .alert-light {
    background-color: #f8f9fa;
  }

  #bmiDisplay {
    font-size: 1.1rem;
    padding: 0.5rem;
    border-radius: 0.25rem;
    background-color: #fff;
  }

  .badge {
    font-size: 0.7rem;
    padding: 0.35em 0.5em;
  }
</style>
{% endblock %}
